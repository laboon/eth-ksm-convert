<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kusama → Ethereum</title>
  <script src="https://shawntabrizi.com/substrate-js-utilities/polkadot-util.min.js"></script>
  <script src="https://shawntabrizi.com/substrate-js-utilities/polkadot-util-crypto.min.js"></script>
</head>
<body>
  <h2>Kusama → Ethereum Converter</h2>

  <input id="ksmAddress" placeholder="Enter Kusama address" />
  <button id="convert">Convert</button>
  <pre id="output">–</pre>

  <script>
    window.addEventListener("load", () => {
      const polkadotUtil = window.polkadotUtil;
      const polkadotUtilCrypto = window.polkadotUtilCrypto;

      if (!polkadotUtil || !polkadotUtilCrypto) {
        document.getElementById("output").textContent = "❌ Libraries failed to load.";
        return;
      }

      function isValidEthHex(hex) {
        return /^0x[a-fA-F0-9]{40}$/.test(hex);
      }

      document.getElementById("convert").addEventListener("click", () => {
        const input = document.getElementById("ksmAddress").value.trim();
        const output = document.getElementById("output");

        try {
          const [u8a, prefix] = polkadotUtilCrypto.decodeAddress(input, true);
          if (prefix !== 2) {
            output.textContent = "❌ Not a Kusama address (prefix is " + prefix + ")";
            return;
          }

          const ethHex = polkadotUtil.u8aToHex(u8a);
          if (!isValidEthHex(ethHex)) {
            output.textContent = "⚠️ Decoded value is not a valid Ethereum address.";
            return;
          }

          output.textContent = "✅ Ethereum address: " + ethHex;
        } catch (err) {
          output.textContent = "❌ Error: " + err.message;
        }
      });
    });
  </script>
</body>
</html>
